# Node-RED Cloudflare Tunnels

## Overview

This Node-RED node allows you to easily create and manage secure Cloudflare tunnels directly from your Node-RED flows using the `cloudflared` binary. With this node, you can expose local services to the internet securely without complex network configurations.

## Features

- **Creates Cloudflare tunnels** directly from Node-RED.
- **Automatically manages tunnels** to prevent redundant or failed tunnels.
- **Outputs the public URL** generated by Cloudflare for accessing your local service.
- Stores tunnel information in the **global context** of Node-RED for easy management and monitoring.

## Installation

To install the `@inutil-labs/node-red-cloudflare-tunnels` node in your Node-RED setup, run the following command:

```bash
npm install @inutil-labs/node-red-cloudflare-tunnels
```

## Usage

Once installed, you can use the node in your Node-RED flow by adding a `cloudflared` node. The node offers three modes of operation, configurable via its settings:

#### 1. Test Mode (Default)

In this mode, the tunnel is established in a testing environment. No local URL is exposed, and instead, a default page is displayed to indicate whether the tunnel has been successfully established. This mode corresponds to the "hello-world" example from the Cloudflare Developers documentation.

#### 2. Quick Tunnel Mode

This is the most commonly used mode for scenarios where you do not have your own domain managed in a Cloudflare account. In this mode, the local URL defined in the node configuration is exposed through a temporary public URL provided by Cloudflare. This allows quick and straightforward access to local services without the need for additional configuration.

#### 3. Managed Tunnel Mode

In this mode, you can establish a tunnel using a token from your Cloudflare account. This mode is intended for users with their own domain hosted on Cloudflare. The local URLs and their associated public URLs are defined and managed through the Cloudflare user interface. A token is required to enable this mode.

### Input

- The node doesn't require specific input to trigger the tunnel creation. It will automatically start a Cloudflare tunnel once deployed.

## Output

The output of the node is an object sent via `msg.payload`, structured as follows:

```json
{
  "tunnelCreated": "https://example.trycloudflare.com",
  "localUrl": "http://localhost:1880"
}
```

Where:

- **`tunnelCreated`**: The public URL of the Cloudflare tunnel.
- **`localUrl`**: The local URL of the service exposed through the tunnel (optional).

## Example Flow

Hereâ€™s an example of how to use the node in a flow:

1. Use an **Inject node** to trigger the `cloudflared` node.
2. The `cloudflared` node will create a tunnel and output the public URL to `msg.payload.tunnelCreated`.
3. You can use a **Debug node** to log the URL or use it for further processing in your flow.

## Configuration

The node has the following configurable options:

- **Cloudflared Path**: The path to the `cloudflared` binary on your system.
- **Local URL**: The local URL you want to expose (optional).
- **Node-RED Global Context**: The node stores information about the tunnel in the Node-RED global context under the `tunelList` key.

## License

MIT License. See LICENSE for more information.
